window.Enhanced_Content = function($,options){var $stepHeader=$(".step-header"),$showMore=$("#show-more"),$guidance=$("#general-guidance"),$steps=$("#steps"),$answers=$("#answers"),isNonSub=options.isNonSub,renderError=options.renderError,showOnboarding=options.showOnboarding,doSessionLog=function(e,n){e.destination_url=window.location.href,e.referrer_url=document.referrer,e.type="session";var s=escape(JSON.stringify(e)),t="?type="+e.type+"&value="+s,o=n||null;$.ajax({url:"/study/_ajax/log"+t,type:"GET",data:{options:{logSubscription:1}},success:o,error:function(e){console.log("Error session logging: "+JSON.stringify(e))}})},storeViewKvp=function(e){$.ajax({url:"/study/_ajax/common/userkvp/set",type:"GET",data:{token:C.global.csrfToken,key:"enhancedcontent-view",value:e},error:function(e){console.log("Error storing user kvp value "+JSON.stringify(e))}})},isTrue=function(e){return"true"===e};isTrue(renderError)&&doSessionLog({ec_error:"1"}),$(".expl-key").on("click",function(e){$(this).addClass("highlight");var n=$(this).closest(".step-content");n.find(".expl-content").removeClass("hidden"),n.find(".mistakes-content, .hint-content").addClass("hidden"),n.find(".mistakes-key, .hint-key").removeClass("highlight"),$(".onboard-step").remove(),doSessionLog({qna_enhanced_content_information_click:"explanation"})}),$(".mistakes-key").on("click",function(e){$(this).addClass("highlight");var n=$(this).closest(".step-content");n.find(".mistakes-content").removeClass("hidden"),n.find(".expl-content, .hint-content").addClass("hidden"),n.find(".expl-key, .hint-key").removeClass("highlight"),$(".onboard-step").remove(),doSessionLog({qna_enhanced_content_information_click:"mistakes"})}),$(".hint-key").on("click",function(e){$(this).addClass("highlight");var n=$(this).closest(".step-content");n.find(".hint-content").removeClass("hidden"),n.find(".expl-content, .mistakes-content").addClass("hidden"),n.find(".expl-key, .mistakes-key").removeClass("highlight"),$(".onboard-step").remove(),doSessionLog({qna_enhanced_content_information_click:"hints"})}),$("#view-first").on("click",function(e,n){$(this).addClass("highlight"),$("#view-all, #view-answer").removeClass("highlight"),$steps.removeClass("hidden"),$answers.addClass("hidden"),$('.step-wrapper[data-number="1"] .step-content').slideDown("fast"),$('.step-wrapper:not([data-number="1"]) .step-content').slideUp("fast"),$('.step-wrapper:not([data-number="1"]) .caret').removeClass("open"),n||$(".onboard-view").remove(),doSessionLog({qna_enhanced_content_click:"first_step"},function(){storeViewKvp("first_step")})}),$("#view-all").on("click",function(e,n){$(this).addClass("highlight"),$("#view-first, #view-answer").removeClass("highlight"),$steps.removeClass("hidden"),$answers.addClass("hidden"),$(".step-content").slideDown("fast"),$("#steps .caret").addClass("open"),n||$(".onboard-view").remove(),doSessionLog({qna_enhanced_content_click:"all_steps"},function(){storeViewKvp("all_steps")})}),$("#view-answer").on("click",function(e,n){$(this).hasClass("highlight")||($(this).addClass("highlight"),$("#view-first, #view-all").removeClass("highlight"),$answers.removeClass("hidden"),$steps.addClass("hidden"),n||$(".onboard-view").remove(),doSessionLog({qna_enhanced_content_click:"answer_only"},function(){storeViewKvp("answer_only")}))}),isTrue(isNonSub)?($showMore.on("click",function(){doSessionLog({qna_enhanced_content_guidance_expand:1},function(){$(".sunkist-obfuscation .dialog .cta-btn").trigger("click")})}),$(".see-all-steps").on("click",function(){doSessionLog({qna_enhanced_content_all_steps_click:1},function(){$(".sunkist-obfuscation .dialog .cta-btn").trigger("click")})})):($(".selected-view").trigger("click",!0),$stepHeader.on("click",function(e){var n=$(this).next(),s=$(this).parent(),t=$(this).find(".caret");n.slideToggle("fast",function(){s.attr("data-open",!s.data("open")),s.removeData("open"),t.toggleClass("open"),"1"==t.attr("data-number")&&(t.removeData("number"),t.attr("data-number",0),t.removeClass("open")),doSessionLog(t.hasClass("open")?{qna_enhanced_content_step_expand:s.data("number")}:{qna_enhanced_content_step_collapse:s.data("number")})})}),$showMore.on("click",function(){$(this).hasClass("show-less")?($(this).removeClass("show-less").html('Show more <span class="caret"></span>'),$guidance.removeClass("viewable visible"),doSessionLog({qna_enhanced_content_guidance_collapse:1})):($(this).addClass("show-less").html('Show less <span class="caret open"></span>'),$guidance.addClass("viewable visible"),doSessionLog({qna_enhanced_content_guidance_expand:1}))}),isTrue(showOnboarding)&&$(".step-wrapper[data-number=1] .step-keys").append('<img class="onboard-step" src="https://c.cheggcdn.com/assets/site/images/img-ecpromo-message2arrow.png">'));}